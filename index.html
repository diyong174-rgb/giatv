<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>3rstv</title>
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body { font-family: Arial, sans-serif; background:#111; color:#fff; }

    /* Login Page */
    .login-page { display:flex; justify-content:center; align-items:center; height:100vh; background-color:#222; }
    .login-form { display:flex; flex-direction:column; align-items:center; width:100%; max-width:300px; padding:20px; background:#333; border-radius:10px; }
    .login-form input { margin:10px 0; padding:12px; width:100%; border:1px solid #444; border-radius:5px; background:#222; color:#fff; }
    .login-form button { padding:12px; background:#00aaff; border:none; border-radius:5px; width:100%; cursor:pointer; color:#fff; font-size:16px; }
    .login-form button:hover { background:#0099cc; }

    /* IPTV Content */
    .iptv-content { display:none; }

    /* Header */
    .header { display:flex; justify-content:space-between; align-items:center; padding:5px 10px; background:#222; position:sticky; top:0; z-index:10; }
    .logo img { width:50px; }
    .center-section { display:flex; gap:8px; align-items:center; font-size:12px; }
    .right-section { display:flex; gap:8px; align-items:center; }
    .username-pill { padding:6px 8px; border-radius:999px; background:#333; border:1px solid #444; font-size:12px; }
    .logout-btn { font-size:12px; padding:6px 10px; border-radius:8px; background:#0056b3; color:#fff; border:none; cursor:pointer; }
    .logout-btn:hover { background:#00aaff; }

    /* Channel Drawer Header */
    .channel-header { font-size:16px; font-weight:bold; margin:10px 0; color:#00aaff; text-shadow:0 0 10px #00aaff, 0 0 20px #00aaff; }

    /* Video */
    .video-container { width:70%; height:600px; background:#333; margin-bottom:30px; display:flex; justify-content:center; align-items:center; position:relative; border-radius:10px; overflow:hidden; }
    .video-container iframe, .video-container video { width:100%; height:100%; border:none; }
    .video-placeholder { position:absolute; inset:0; background-size:cover; background-position:center; opacity:.25; }

    /* Drawer */
    .channel-drawer { width:28%; background:#444; margin-top:0; padding:10px; border-radius:10px; overflow-x:auto; max-height:100%; position:relative; }

    /* Channel Item Styling */
    .channel-item { display:flex; flex-direction:column; justify-content:center; align-items:center; padding:15px; margin:5px; background:#0056b3; border-radius:10px; transition:.3s ease; color:#fff; }
    .channel-item:hover { background:#00aaff; cursor:pointer; box-shadow:0 0 10px rgba(0,170,255,.8); transform:scale(1.05); color:#000; }
    .channel-item .channel-name { font-size:18px; font-weight:bold; text-shadow:0 0 10px #00aaff, 0 0 20px #00aaff; text-align:center; }

    .categories { display:flex; justify-content:flex-start; margin-top:10px; flex-wrap:nowrap; overflow-x:auto; }
    .category { font-size:14px; padding:8px 16px; background:#333; border-radius:5px; cursor:pointer; transition:.3s ease; margin:5px; white-space:nowrap; }
    .category:hover { background:#00aaff; }

    button { font-size:18px; padding:12px; border-radius:10px; background:#0056b3; color:#fff; margin:10px; border:none; cursor:pointer; transition:.3s ease; }
    button:hover { background:#00aaff; box-shadow:0 0 10px rgba(0,170,255,.8); }

    /* Mobile */
    @media (max-width: 767px) {
      .header { 
        padding: 5px 10px;
        flex-direction: row; 
        justify-content: space-between; 
        align-items: center; 
        font-size: 10px; /* Reduce font size */
      }

      .logo img {
        width: 40px; /* Reduce the logo size */
      }

      .center-section {
        display: flex;
        gap: 5px; /* Reduce space between buttons */
        font-size: 10px; /* Smaller font for mobile */
      }

      .right-section {
        display: flex;
        gap: 5px; /* Reduce space between logout and username */
        align-items: center;
      }

      .username-pill {
        font-size: 10px; /* Smaller username pill */
        padding: 4px 6px; /* Adjust padding */
      }

      .logout-btn {
        font-size: 10px; /* Smaller logout button */
        padding: 4px 6px; /* Adjust padding */
      }

      button {
        font-size: 14px; /* Slightly reduce the button size */
        padding: 10px 12px; /* Adjust padding for mobile */
      }

      .category {
        font-size: 12px; /* Smaller category font */
      }

      .video-container {
        width: 100%; 
        height: 250px; /* Adjust video height for mobile */
      }

      .channel-drawer {
        margin-bottom: 10px;
        padding: 0;
        width: 100%; /* Full width for channel drawer */
      }

      .category {
        margin-right: 10px;
        font-size: 12px;
      }

      .channel-item {
        width: 100%; 
        height: 80px; 
        margin-bottom: 10px;
        padding: 10px;
      }

      #channel-list {
        max-height: 60vh; 
        overflow-y: scroll;
      }

      .content-wrapper { 
        display: block; 
        padding: 10px; 
      }
    }

    /* Desktop */
    @media (min-width: 768px) {
      .content-wrapper { display:flex; justify-content:space-between; gap:12px; padding:10px; }
      .video-container { width:70%; height:600px; }
      .channel-drawer { width:28%; height:auto; }
      .categories { flex-direction:row; }
      .category { width:auto; margin-left:10px; }
      #channel-list { max-height:60vh; overflow-y:scroll; }
    }
  </style>
</head>
<body>

  <!-- Login Page -->
  <div id="login-page" class="login-page">
    <form class="login-form" onsubmit="event.preventDefault(); login();">
      <h2>Login</h2>
      <input type="text" id="username" placeholder="Username" autocomplete="username"/>
      <input type="password" id="password" placeholder="Password" autocomplete="current-password"/>
      <button type="submit">Login</button>
    </form>
  </div>

  <!-- IPTV Content -->
  <div id="iptv-content" class="iptv-content">
    <!-- Header -->
    <div class="header">
      <div class="logo">
        <img src="https://i.ibb.co/nN0VGRY8/Chat-GPT-Image-Oct-4-2025-05-05-12-AM-1.png" alt="IPTV Logo">
      </div>

      <div class="center-section">
        <button onclick="alert('Comments coming soon')">Comment</button>
        <button onclick="showAddChannelForm()">+ Channel</button>
      </div>

      <div class="right-section">
        <div id="display-username" class="username-pill">@user</div>
        <button class="logout-btn" onclick="logout()">Logout</button>
      </div>
    </div>

    <!-- Channel Drawer Header with Username -->
    <div class="channel-header">
      Welcome, <span id="display-username-channel"></span>!
    </div>

    <!-- Content -->
    <div class="content-wrapper">
      <div class="video-container" id="video-player">
        <!-- player inserted here -->
      </div>

      <div class="channel-drawer">
        <div class="categories">
          <div class="category" onclick="showChannelList('CABLE')">Cable</div>
          <div class="category" onclick="showChannelList('YOUTUBE')">YouTube</div>
          <div class="category" onclick="showChannelList('MOVIES')">Movies</div>
          <div class="category" onclick="showChannelList('RADIO')">Radio</div>
          <div class="category" onclick="showChannelList('ADDED')">Added Channel</div>
        </div>
        <div id="channel-list"></div>
      </div>
    </div>
  </div>

  <!-- Players -->
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  <script src="https://cdn.dashjs.org/latest/dash.all.min.js"></script>
  <script src="https://unpkg.com/shaka-player@2.5.0/dist/shaka-player.compiled.js"></script>

  <script>
    // === AUTH / USERNAME ===
    const USERNAME_KEY = 'iptvUsername';

    function setUsernameDisplay(name) {
      const el = document.getElementById('display-username');
      const elChannel = document.getElementById('display-username-channel');
      el.textContent = name ? name : '@user';
      elChannel.textContent = name ? name : '@user';
    }

    function showApp() {
      document.getElementById('login-page').style.display = 'none';
      document.getElementById('iptv-content').style.display = 'block';
    }

    function showLogin() {
      document.getElementById('iptv-content').style.display = 'none';
      document.getElementById('login-page').style.display = 'flex';
    }

    function login() {
      const username = document.getElementById('username').value.trim();
      const password = document.getElementById('password').value;

      if (!username || !password) {
        alert('Please enter both username and password');
        return;
      }

      localStorage.setItem(USERNAME_KEY, username);
      setUsernameDisplay(username);
      showApp();
    }

    function logout() {
      localStorage.removeItem(USERNAME_KEY);
      setUsernameDisplay('');
      showLogin();
    }

    document.addEventListener('DOMContentLoaded', () => {
      const saved = localStorage.getItem(USERNAME_KEY);
      if (saved) { 
        setUsernameDisplay(saved); 
        showApp(); 
      } else { 
        showLogin(); 
      }

      // Automatically show the channel list for 'CABLE' when the page loads
      showChannelList('CABLE');
    });

    // === MEDIA PLAYER CORE ===
    let currentPlayer = null;

    function destroyPlayers() {
      if (currentPlayer) { try { currentPlayer.destroy(); } catch(e){} currentPlayer = null; }
    }

    function playChannel(channel) {
      const container = document.getElementById('video-player');
      destroyPlayers();
      container.innerHTML = '';

      // Create video element
      const video = document.createElement('video');
      video.controls = true;
      video.playsInline = true;
      video.autoplay = true;
      video.preload = 'auto';
      container.appendChild(video);

      if (channel.type === 'mpd') {
        // Shaka Player for MPD with DRM
        currentPlayer = new shaka.Player(video);
        currentPlayer.configure({
          drm: {
            clearKeys: {
              [channel.keyId]: channel.key
            }
          }
        });
        currentPlayer.load(channel.url).then(() => {
          console.log('MPD with DRM loaded successfully');
        }).catch(error => {
          console.error('Error loading MPD with DRM:', error);
        });
        return;
      }

      // Other types (hls, youtube, etc.)
      if (channel.type === 'hls') {
        const hls = new Hls();
        hls.loadSource(channel.url);
        hls.attachMedia(video);
        return;
      }

      // Handle other types...
    }

    // === CHANNELS ===
    const channels = {
      CABLE: [
        { name: '3RsTV', url: 'https://live20.bozztv.com/giatvplayout7/giatv-210631/tracks-v1a1/mono.ts.m3u8', type: 'hls', logo: '' },
        { name: 'STAR TELEVISION', url: 'https://live20.bozztv.com/giatvplayout7/giatv-210731/tracks-v1a1/mono.ts.m3u8', type: 'hls', logo: '' },
        { name: 'SONY PIX', url: 'https://topsports.watch/sonyliv/stream.php?id=sony-pix-hd&format=.m3u8', type: 'hls', logo: '' },
        // Add more channels here...
      ],
      ADDED: [
        { name: 'A2Z', url: 'https://qp-pldt-live-bpk-02-prod.akamaized.net/bpk-tv/cg_a2z/default/index.mpd', keyId: 'f703e4c8ec9041eeb5028ab4248fa094', key: 'c22f2162e176eee6273a5d0b68d19530', type: 'mpd', logo: 'https://i.imgur.com/3myn4zH.png' },
        { name: 'RPTV', url: 'https://qp-pldt-live-bpk-02-prod.akamaized.net/bpk-tv/cnn_rptv_prod_hd/default/index.mpd', keyId: '1917f4caf2364e6d9b1507326a85ead6', key: 'a1340a251a5aa63a9b0ea5d9d7f67595', type: 'mpd', logo: 'https://i.imgur.com/IDCHfXm.png' }
      ]
    };

    // Function to show channel list with autoplay on channel selection
    function showChannelList(category) {
      const channelList = channels[category] || [];
      const wrap = document.getElementById('channel-list');
      wrap.innerHTML = '';
      channelList.forEach(ch => {
        const el = document.createElement('div');
        el.className = 'channel-item';
        el.innerHTML = `<div class="channel-name">${ch.name}</div>`;
        el.onclick = () => {
          playChannel(ch); // Autoplay when clicked
        };
        wrap.appendChild(el);
      });
    }

  </script>
</body>
</html>
