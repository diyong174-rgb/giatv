<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>3RsTV</title>
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body { font-family: Arial, sans-serif; background:#111; color:#fff; }

    /* Login Page */
    .login-page { display:flex; justify-content:center; align-items:center; height:100vh; background-color:#222; }
    .login-form { display:flex; flex-direction:column; align-items:center; width:100%; max-width:300px; padding:20px; background:#333; border-radius:10px; }
    .login-form input { margin:10px 0; padding:12px; width:100%; border:1px solid #444; border-radius:5px; background:#222; color:#fff; }
    .login-form button { padding:12px; background:#00aaff; border:none; border-radius:5px; width:100%; cursor:pointer; color:#fff; font-size:16px; }
    .login-form button:hover { background:#0099cc; }

    /* IPTV Content */
    .iptv-content { display:none; }

    /* Header */
    .header { display:flex; justify-content:space-between; align-items:center; padding:5px 10px; background:#222; position:sticky; top:0; z-index:10; }
    .logo img { width:50px; }
    .center-section { display:flex; gap:8px; align-items:center; font-size:12px; }
    .right-section { display:flex; gap:8px; align-items:center; }
    .username-pill { padding:6px 8px; border-radius:999px; background:#333; border:1px solid #444; font-size:12px; }
    .logout-btn { font-size:12px; padding:6px 10px; border-radius:8px; background:#0056b3; color:#fff; border:none; cursor:pointer; }
    .logout-btn:hover { background:#00aaff; }

    /* Channel Drawer Header */
    .channel-header { font-size:16px; font-weight:bold; margin:10px 0; color:#00aaff; text-shadow:0 0 10px #00aaff, 0 0 20px #00aaff; }

    /* Video */
    .video-container { width:70%; height:600px; background:#333; margin-bottom:30px; display:flex; justify-content:center; align-items:center; position:relative; border-radius:10px; overflow:hidden; }
    .video-container iframe, .video-container video { width:100%; height:100%; border:none; }
    .video-placeholder { position:absolute; inset:0; background-size:cover; background-position:center; opacity:.25; }

    /* Drawer */
    .channel-drawer { width:28%; background:#444; margin-top:0; padding:10px; border-radius:10px; overflow-x:auto; max-height:100%; position:relative; }

    /* Channel Item Styling */
    .channel-item { display:flex; flex-direction:column; justify-content:center; align-items:center; padding:15px; margin:5px; background:#0056b3; border-radius:10px; transition:.3s ease; color:#fff; }
    .channel-item:hover { background:#00aaff; cursor:pointer; box-shadow:0 0 10px rgba(0,170,255,.8); transform:scale(1.05); color:#000; }
    .channel-item .channel-name { font-size:18px; font-weight:bold; text-shadow:0 0 10px #00aaff, 0 0 20px #00aaff; text-align:center; }

    .categories { display:flex; justify-content:flex-start; margin-top:10px; flex-wrap:nowrap; overflow-x:auto; }
    .category { font-size:14px; padding:8px 16px; background:#333; border-radius:5px; cursor:pointer; transition:.3s ease; margin:5px; white-space:nowrap; }
    .category:hover { background:#00aaff; }

    button { font-size:18px; padding:12px; border-radius:10px; background:#0056b3; color:#fff; margin:10px; border:none; cursor:pointer; transition:.3s ease; }
    button:hover { background:#00aaff; box-shadow:0 0 10px rgba(0,170,255,.8); }

    /* Mobile */
    @media (max-width: 767px) {
      .header { 
        flex-direction: row; 
        justify-content: space-between; 
        align-items: center; 
        padding: 5px 10px; 
        font-size: 12px; 
        display: flex;
        gap: 10px;
      }
      .logo img { width: 40px; }

      .center-section {
        font-size: 12px;
        gap: 5px;
        display: flex;
        flex-grow: 1;
        justify-content: center;
      }

      .right-section { 
        display: flex;
        gap: 8px;
        align-items: center;
        justify-content: flex-end;
      }

      /* Adjusting layout for logo, comment button, username, and logout */
      .logout-btn {
        font-size: 10px;
        padding: 6px 8px;
        border-radius: 8px;
        background: #0056b3;
        color: #fff;
        border: none;
        cursor: pointer;
      }

      .logout-btn:hover {
        background: #00aaff;
      }

      .comment-btn {
        font-size: 10px;
        padding: 6px 8px;
        background: #00aaff;
        color: white;
        border-radius: 8px;
        border: none;
        cursor: pointer;
      }

      .comment-btn:hover {
        background: #0099cc;
      }

      .username-pill {
        font-size: 12px;
        padding: 6px 8px;
        border-radius: 8px;
        background: #333;
        border: 1px solid #444;
      }
    }
  </style>
</head>
<body>

<!-- Login Page -->
<div id="login-page" class="login-page">
  <form class="login-form" onsubmit="event.preventDefault(); login();">
    <h2>Login</h2>
    <input type="text" id="username" placeholder="Username" autocomplete="username"/>
    <input type="password" id="password" placeholder="Password" autocomplete="current-password"/>
    <button type="submit">Login</button>
  </form>
</div>

<!-- IPTV Content -->
<div id="iptv-content" class="iptv-content">
  <!-- Header -->
  <div class="header">
    <div class="logo">
      <img src="https://i.ibb.co/nN0VGRY8/Chat-GPT-Image-Oct-4-2025-05-05-12-AM-1.png" alt="IPTV Logo">
    </div>

    <div class="center-section">
      <button class="comment-btn" onclick="alert('Comments coming soon')">Comment</button>
      <button onclick="showAddChannelForm()">+ Channel</button>
    </div>

    <div class="right-section">
      <div id="display-username" class="username-pill">@user</div>
      <button class="logout-btn" onclick="logout()">Logout</button>
    </div>
  </div>

  <!-- Channel Drawer Header with Username -->
  <div class="channel-header">
    Welcome, <span id="display-username-channel"></span>!
  </div>

  <!-- Content -->
  <div class="content-wrapper">
    <div class="video-container" id="video-player">
      <!-- player inserted here -->
    </div>

    <div class="channel-drawer">
      <div class="categories">
        <div class="category" onclick="showChannelList('CABLE')">Cable</div>
        <div class="category" onclick="showChannelList('YOUTUBE')">YouTube</div>
        <div class="category" onclick="showChannelList('MOVIES')">Movies</div>
        <div class="category" onclick="showChannelList('RADIO')">Radio</div>
        <div class="category" onclick="showChannelList('ADDED')">Added Channel</div>
      </div>
      <div id="channel-list"></div>

      <!-- Comment Section -->
      <div class="comment-section">
        <textarea id="comment-box" class="comment-box" placeholder="Write a comment..."></textarea>
        <button class="comment-button" onclick="postComment()">Post Comment</button>
        <div id="comments-list" class="comments-list"></div>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
<script src="https://cdn.dashjs.org/latest/dash.all.min.js"></script>
<script src="https://unpkg.com/shaka-player/dist/shaka-player.compiled.js"></script>

<script>
  // === AUTH / USERNAME ===
  const USERNAME_KEY = 'iptvUsername';

  function setUsernameDisplay(name) {
    const el = document.getElementById('display-username');
    const elChannel = document.getElementById('display-username-channel');
    el.textContent = name ? name : '@user';
    elChannel.textContent = name ? name : '@user';
  }

  function showApp() {
    document.getElementById('login-page').style.display = 'none';
    document.getElementById('iptv-content').style.display = 'block';
  }

  function showLogin() {
    document.getElementById('iptv-content').style.display = 'none';
    document.getElementById('login-page').style.display = 'flex';
  }

  function login() {
    const username = document.getElementById('username').value.trim();
    const password = document.getElementById('password').value;

    if (!username || !password) {
      alert('Please enter both username and password');
      return;
    }

    localStorage.setItem(USERNAME_KEY, username);
    setUsernameDisplay(username);
    showApp();
  }

  function logout() {
    localStorage.removeItem(USERNAME_KEY);
    setUsernameDisplay('');
    showLogin();
  }

  document.addEventListener('DOMContentLoaded', () => {
    const saved = localStorage.getItem(USERNAME_KEY);
    if (saved) { setUsernameDisplay(saved); showApp(); } else { showLogin(); }
  });

  // === CHANNEL DATA ===
  const channels = {
    CABLE: [
      { name: '3RsTV', url: 'https://live20.bozztv.com/giatvplayout7/giatv-210631/tracks-v1a1/mono.ts.m3u8', type: 'hls' },
      { name: '3rsSinePinoy', url: 'https://live20.bozztv.com/giatvplayout7/giatv-210267/tracks-v1a1/mono.ts.m3u8', type: 'hls' },
      { name: 'STAR TELEVISION', url: 'https://live20.bozztv.com/giatvplayout7/giatv-210731/tracks-v1a1/mono.ts.m3u8', type: 'hls' },
      { name: 'JUZT-TV BOX', url: 'https://live20.bozztv.com/giatvplayout7/giatv-210639/tracks-v1a1/mono.ts.m3u8', type: 'hls' }
    ],
    YOUTUBE: [
      { name: 'YOUTUBE LIVE MOVIES', url: 'https://www.youtube.com/embed/uNhKfQJNFEw', type: 'youtube' },
      { name: 'YOUTUBE LIVE MOVIES (BATMAN)', url: 'https://www.youtube.com/embed/XBvUft9a23s', type: 'youtube' },
      { name: 'ROCKSTAR2 GREATEST HITS', url: 'https://www.youtube.com/embed/TfRj7VGkAr0', type: 'youtube' }
    ],
    MOVIES: [
      { name: 'May lamok sa loob ng kulambo', url: 'https://jungotvmedia.chanall.tv/jungotv/SolarMayLamokSaKulamboTGFULL10mbps/playlist_720p.m3u8', type: 'movies' },
      { name: 'Darna at Ding', url: 'https://jungotvmedia.chanall.tv/jungotv/SOLARDarnaAtDingFULL10mbps/playlist_720p.m3u8', type: 'movies' }
    ],
    RADIO: [
      { name: '106.3 Yes FM', url: 'https://yesfmdagupan.radioca.st/;', type: 'mp3', logo: 'https://i.ibb.co/yBqNhTZN/raryo.jpg' },
      { name: '98.3 Love Radio', url: 'https://loveradiodagupan.radioca.st/;', type: 'mp3', logo: 'https://i.ibb.co/yBqNhTZN/raryo.jpg' }
    ],
    ADDED: []
  };

  // === PLAYERS ===
  let hlsInstance = null;
  let dashInstance = null;
  let shakaPlayerInstance = null;

  function destroyPlayers() {
    if (hlsInstance) { try { hlsInstance.destroy(); } catch(e){} hlsInstance = null; }
    if (dashInstance) { try { dashInstance.reset(); } catch(e){} dashInstance = null; }
    if (shakaPlayerInstance) { try { shakaPlayerInstance.destroy(); } catch(e){} shakaPlayerInstance = null; }
  }

  function playChannel(channel) {
    const container = document.getElementById('video-player');
    destroyPlayers();
    container.innerHTML = '';

    // Map legacy types
    const type = (channel.type === 'movies') ? 'hls' : channel.type;

    // YouTube
    if (type === 'youtube') {
      const iframe = document.createElement('iframe');
      iframe.src = channel.url;
      iframe.allow = "accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share";
      iframe.allowFullscreen = true;
      container.appendChild(iframe);
      return;
    }

    // MP3 (Audio only with backdrop)
    if (type === 'mp3') {
      const placeholder = document.createElement('div');
      placeholder.className = 'video-placeholder';
      if (channel.logo) { placeholder.style.backgroundImage = `url('${channel.logo}')`; }
      container.appendChild(placeholder);
      const audio = document.createElement('audio');
      audio.controls = true;
      audio.src = channel.url;
      audio.preload = 'none';
      container.appendChild(audio);
      audio.play();
      return;
    }

    // DASH (MPD) - Use Shaka Player
    if (type === 'mpd') {
      const video = document.createElement('video');
      video.controls = true;
      container.appendChild(video);
      shakaPlayerInstance = new shaka.Player(video);
      shakaPlayerInstance.configure({
        drm: { clearKeys: { [channel.keyId]: channel.key } }
      });
      shakaPlayerInstance.load(channel.url).then(() => {
        video.play();
      }).catch(error => {
        alert('Error loading MPD stream.');
      });
      return;
    }

    // Video (HLS/MP4)
    const video = document.createElement('video');
    video.controls = true;
    video.autoplay = true;
    video.preload = 'none';
    container.appendChild(video);

    // MP4
    if (type === 'mp4' || (/\.mp4($|\?)/i).test(channel.url)) {
      const source = document.createElement('source');
      source.src = channel.url;
      source.type = 'video/mp4';
      video.appendChild(source);
      video.load();
      return;
    }

    // HLS (.m3u8)
    if (type === 'hls' || (/\.m3u8($|\?)/i).test(channel.url)) {
      if (window.Hls && Hls.isSupported()) {
        hlsInstance = new Hls({ maxBufferLength: 30 });
        hlsInstance.loadSource(channel.url);
        hlsInstance.attachMedia(video);
      } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
        video.src = channel.url; // Safari
      } else {
        alert('HLS is not supported in this browser.');
      }
      return;
    }

    alert('Stream type is unsupported or invalid.');
  }

  function showChannelList(category) {
    const channelList = channels[category] || [];
    const wrap = document.getElementById('channel-list');
    wrap.innerHTML = '';
    channelList.forEach(ch => {
      const el = document.createElement('div');
      el.className = 'channel-item';
      el.innerHTML = `<div class="channel-name">${ch.name}</div>`;
      el.onclick = () => playChannel(ch);
      wrap.appendChild(el);
    });

    // Autoplay the first channel in the category
    if (channelList.length > 0) {
      playChannel(channelList[0]);
    }
  }

  function showAddChannelForm() {
    const name = prompt("Enter Channel Name:");
    const url = prompt("Enter Channel URL:");
    if (name && url) {
      channels.ADDED.push({ name, url, type: 'hls' });
      showChannelList('ADDED');
    }
  }

  // === COMMENT SECTION ===
  function postComment() {
    const commentBox = document.getElementById('comment-box');
    const comment = commentBox.value.trim();

    if (comment) {
      const list = document.getElementById('comments-list');
      const item = document.createElement('div');
      item.className = 'comment-item';

      // Get current time
      const currentTime = new Date().toLocaleTimeString();

      item.innerHTML = `<span class="comment-username">@user</span> <span class="comment-time">(${currentTime})</span>: ${comment}`;
      list.appendChild(item);
      commentBox.value = '';
    }
  }
</script>
</body>
</html>
